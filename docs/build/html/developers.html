

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Developers &mdash; XACC 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Advanced" href="advanced.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> XACC
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#writing-a-plugin-in-c">Writing a Plugin in C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-a-plugin-in-python">Writing a Plugin in Python</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">XACC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Developers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/developers.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="developers">
<h1>Developers<a class="headerlink" href="#developers" title="Permalink to this headline">¶</a></h1>
<p>Here we describe how XACC developers can extend the framework
with new Compilers, Accelerators, Instructions, IR Transformations, etc.
This can be done from both C++ and Python.</p>
<div class="section" id="writing-a-plugin-in-c">
<h2>Writing a Plugin in C++<a class="headerlink" href="#writing-a-plugin-in-c" title="Permalink to this headline">¶</a></h2>
<p>Let’s demonstrate how one might add a new IR Transformation
implementation to XACC. This is a simple case, but the overall structure
works across most plugins.</p>
<p>First, we create a new project folder <code class="docutils literal notranslate"><span class="pre">test_ir_transformation</span></code> and
populate it with a <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file, and a <code class="docutils literal notranslate"><span class="pre">src</span></code> folder containing another
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file as well as <code class="docutils literal notranslate"><span class="pre">manifest.json</span></code>, <code class="docutils literal notranslate"><span class="pre">test_ir_transformation.hpp</span></code>,
<code class="docutils literal notranslate"><span class="pre">test_ir_transformation.cpp</span></code>, and <code class="docutils literal notranslate"><span class="pre">test_ir_transformation_activator.cpp</span></code>. You should have
the following directory structure</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>project
├── CMakeLists.txt
├── src
    ├── CMakeLists.txt
    └── manifest.json
    └── test_ir_transformation.hpp
    └── test_ir_transformation.cpp
    └── test_ir_transformation_activator.cpp
</pre></div>
</div>
<p>In the top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> we add the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>project<span class="o">(</span>test_ir_transformation CXX<span class="o">)</span>
cmake_minimum_required<span class="o">(</span>VERSION <span class="m">3</span>.9 FATAL_ERROR<span class="o">)</span>
find_package<span class="o">(</span>XACC REQUIRED<span class="o">)</span>
add_subdirectory<span class="o">(</span>src<span class="o">)</span>
</pre></div>
</div>
<p>Basically here we are defining a CMake project, setting the minimum version, locating our XACC install, and
adding the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory to the build.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">src/CMakeLists.txt</span></code> file, we add the following</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>set<span class="o">(</span>LIBRARY_NAME test-ir-transformation<span class="o">)</span>
file<span class="o">(</span>GLOB SRC *.cpp<span class="o">)</span>
usfunctiongetresourcesource<span class="o">(</span>TARGET
                            <span class="si">${</span><span class="nv">LIBRARY_NAME</span><span class="si">}</span>
                            OUT
                            SRC<span class="o">)</span>
usfunctiongeneratebundleinit<span class="o">(</span>TARGET
                            <span class="si">${</span><span class="nv">LIBRARY_NAME</span><span class="si">}</span>
                            OUT
                            SRC<span class="o">)</span>
add_library<span class="o">(</span><span class="si">${</span><span class="nv">LIBRARY_NAME</span><span class="si">}</span> SHARED <span class="si">${</span><span class="nv">SRC</span><span class="si">}</span><span class="o">)</span>
target_link_libraries<span class="o">(</span><span class="si">${</span><span class="nv">LIBRARY_NAME</span><span class="si">}</span> PRIVATE xacc::xacc<span class="o">)</span>
set<span class="o">(</span>_bundle_name test_ir_transformation<span class="o">)</span>
set_target_properties<span class="o">(</span><span class="si">${</span><span class="nv">LIBRARY_NAME</span><span class="si">}</span>
                    PROPERTIES COMPILE_DEFINITIONS
                                <span class="nv">US_BUNDLE_NAME</span><span class="o">=</span><span class="si">${</span><span class="nv">_bundle_name</span><span class="si">}</span>
                                US_BUNDLE_NAME
                                <span class="si">${</span><span class="nv">_bundle_name</span><span class="si">}</span><span class="o">)</span>
usfunctionembedresources<span class="o">(</span>TARGET
                        <span class="si">${</span><span class="nv">LIBRARY_NAME</span><span class="si">}</span>
                        WORKING_DIRECTORY
                        <span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span>
                        FILES
                        manifest.json<span class="o">)</span>
xacc_configure_plugin_rpath<span class="o">(</span><span class="si">${</span><span class="nv">LIBRARY_NAME</span><span class="si">}</span><span class="o">)</span>
install<span class="o">(</span>TARGETS <span class="si">${</span><span class="nv">LIBRARY_NAME</span><span class="si">}</span> DESTINATION <span class="si">${</span><span class="nv">CMAKE_INSTALL_PREFIX</span><span class="si">}</span>/plugins<span class="o">)</span>
</pre></div>
</div>
<p>Here we define the library name, collect all source files, run some
CppMicroServices functions that append extra information to our library,
build the library and link in all required XACC libraries. Next we add
more information to this shared library from the <code class="docutils literal notranslate"><span class="pre">manifest.json</span></code> file,
configure the libraries RPATH, and install to the correct
<code class="docutils literal notranslate"><span class="pre">plugins</span></code> folder in XACC. <code class="docutils literal notranslate"><span class="pre">manifest.json</span></code> should contain the following json</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
  <span class="s2">&quot;bundle.symbolic_name&quot;</span> : <span class="s2">&quot;test_ir_transformation&quot;</span>,
  <span class="s2">&quot;bundle.activator&quot;</span> : true,
  <span class="s2">&quot;bundle.name&quot;</span> : <span class="s2">&quot;Test IR Transformation&quot;</span>,
  <span class="s2">&quot;bundle.description&quot;</span> : <span class="s2">&quot;&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Next we provide the actual code for the test IR Transformation. In the <code class="docutils literal notranslate"><span class="pre">test_ir_transformation.hpp</span></code>
we add the following</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>
<span class="cp">#include</span> <span class="cpf">&quot;IRTransformation.hpp&quot;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">xacc</span><span class="p">;</span>

<span class="k">namespace</span> <span class="n">test</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">Test</span> <span class="o">:</span> <span class="k">public</span> <span class="n">IRTransformation</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Test</span><span class="p">()</span> <span class="p">{}</span>
  <span class="kt">void</span> <span class="n">apply</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">CompositeInstruction</span><span class="o">&gt;</span> <span class="n">program</span><span class="p">,</span>
                     <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Accelerator</span><span class="o">&gt;</span> <span class="n">accelerator</span><span class="p">,</span>
                     <span class="k">const</span> <span class="n">HeterogeneousMap</span><span class="o">&amp;</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="k">override</span><span class="p">;</span>
  <span class="k">const</span> <span class="n">IRTransformationType</span> <span class="nf">type</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="n">IRTransformationType</span><span class="o">::</span><span class="n">Optimization</span><span class="p">;}</span>

  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;test-irt&quot;</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">description</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and in <code class="docutils literal notranslate"><span class="pre">test_ir_transformation.cpp</span></code> we implement <code class="docutils literal notranslate"><span class="pre">apply</span></code></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;test_ir_transformation.hpp&quot;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">test</span> <span class="p">{</span>

<span class="kt">void</span> <span class="n">Test</span><span class="o">::</span><span class="n">apply</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">CompositeInstruction</span><span class="o">&gt;</span> <span class="n">circuit</span><span class="p">,</span>
                             <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Accelerator</span><span class="o">&gt;</span> <span class="n">accelerator</span><span class="p">,</span>
                             <span class="k">const</span> <span class="n">HeterogeneousMap</span> <span class="o">&amp;</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// do transformation on circuit here...</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, we add a <code class="docutils literal notranslate"><span class="pre">BundleActivator</span></code> that creates a <code class="docutils literal notranslate"><span class="pre">shared_ptr</span></code> to our
IR Transformation and registers it with the CppMicroServices framework.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;test_ir_transformation.hpp&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;cppmicroservices/BundleActivator.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cppmicroservices/BundleContext.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;cppmicroservices/ServiceProperties.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">cppmicroservices</span><span class="p">;</span>

<span class="k">namespace</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">US_ABI_LOCAL</span> <span class="nl">TestIRTransformationActivator</span><span class="p">:</span> <span class="k">public</span> <span class="n">BundleActivator</span> <span class="p">{</span>

<span class="k">public</span><span class="o">:</span>

        <span class="n">TestIRTransformationActivator</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">}</span>
        <span class="kt">void</span> <span class="n">Start</span><span class="p">(</span><span class="n">BundleContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">auto</span> <span class="n">t</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">test</span><span class="o">::</span><span class="n">Test</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="n">context</span><span class="p">.</span><span class="n">RegisterService</span><span class="o">&lt;</span><span class="n">xacc</span><span class="o">::</span><span class="n">IRTransformation</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kt">void</span> <span class="n">Stop</span><span class="p">(</span><span class="n">BundleContext</span> <span class="cm">/*context*/</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="p">}</span>

<span class="n">CPPMICROSERVICES_EXPORT_BUNDLE_ACTIVATOR</span><span class="p">(</span><span class="n">TestIRTransformationActivator</span><span class="p">)</span>
</pre></div>
</div>
<p>The majority of this is standard CppMicroservices boilerplate code. The crucial bit that
requires your attention when developing a new plugin is the implementation of <code class="docutils literal notranslate"><span class="pre">Start</span></code>.
Here you create a <code class="docutils literal notranslate"><span class="pre">shared_ptr</span></code> to your instances and register it against the
correct XACC interface type, here <code class="docutils literal notranslate"><span class="pre">IRTransformation</span></code>.</p>
<p>Now, all that is left to do is build your shared library, and install it for use
in the XACC framework</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> test_ir_transformation <span class="o">&amp;&amp;</span> mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
$ cmake .. -DXACC_DIR<span class="o">=</span>~/.xacc
$ make install
</pre></div>
</div>
</div>
<div class="section" id="writing-a-plugin-in-python">
<h2>Writing a Plugin in Python<a class="headerlink" href="#writing-a-plugin-in-python" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="advanced.html" class="btn btn-neutral float-left" title="Advanced" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Alex McCaskey

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>